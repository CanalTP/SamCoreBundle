{% extends "CanalTPSamCoreBundle::generic_list.html.twig" %}

{% block stylesheets %}
    {{ parent() }}
    {% stylesheets 'bundles/canaltpsamcore/css/customer.css' %}
         <link rel="stylesheet" href="{{ asset_url }}?{{ assets_version }}" />
    {% endstylesheets %}
{% endblock %}

{% block left_menu -%}
    <a class="btn btn-default" href="{{ path('sam_customer_list') }}">
        <span class="glyphicon glyphicon-arrow-left"></span> 
        {{'customer.list'|trans}}
    </a>
    <br/><br/>
    <a class="btn btn-danger" href="{{ path('sam_customer_regeneratealltokens', { 'id': customerId }) }}">
        <span class="glyphicon glyphicon-repeat"></span> 
        {{'customer.token.regenerate_all'|trans}}
    </a>
{% endblock %}

{% block table_head -%}
    <th>{{ 'customer.application'|trans }}</th>
    <th>{{ 'customer.token'|trans }}</th>
    <th>{{ 'customer.token.status'|trans }}</th>
    <th>{{ 'customer.token.regenerate'|trans }}</th>
{% endblock %}

{% block table_body -%}
    {% if applicationsTokens|length == 0 %}
        <tr>
            <td colspan="4">
                {{'global.no_items'|trans}}
            </td>
        </tr>
    {% endif %}
    {% for applicationToken in applicationsTokens %}
        <tr>
            <td>{{ applicationToken.application.name }}</td>
            <td>{{ applicationToken.token }}</td>
            {% if applicationToken.isActive %}
                {% if isTokenAllow(applicationToken.token, perimeters) %}
                    <td>{{'customer.token.enable'|trans}}</td>
                {% else %}
                    <td class="disable-token">{{'customer.token.unauthorized'|trans}}</td>
                {% endif %}
            {% else %}
                <td>{{'customer.token.disable'|trans}}</td>
            {% endif %}
            <td><a href="{{ path('sam_customer_regeneratetoken', { 'appId': applicationToken.application.id, 'id': customerId }) }}">
                <span class="glyphicon glyphicon-repeat array"></span>
            </a></td>
        </tr>
    {% endfor %}
{% endblock %}